extern crate rand;
use self::rand::Rng;

use std::string::String;
use std::collections::HashMap;

pub fn map(input: String) -> String {
        let mut confusables = HashMap::new();
    
    confusables.insert('A', vec!['\u{FF21}','\u{1D400}','\u{1D434}',
        '\u{19468}','\u{1D49C}','\u{1D4D0}','\u{1D504}','\u{1D538}','\u{1D56C}','\u{1D5A0}','\u{1D5D4}','\u{1D608}',
        '\u{1D63C}','\u{1D670}','\u{1D00}','\u{0391}','\u{1D6A8}','\u{1D6E2}','\u{1D71C}','\u{1D756}','\u{1D790}',
        '\u{0410}','\u{13AA}','\u{15C5}','\u{A4EE}','\u{102A0}']);

    confusables.insert('B', vec!['\u{FF22}','\u{212C}','\u{1D401}','\u{1D435}','\u{1D469}','\u{1D4D1}','\u{1D505}','\u{1D609}','\u{1D63D}','\u{1D671}','\u{0392}','\u{1D6A9}','\u{1D6E3}','\u{1D71D}','\u{1D757}','\u{1D791}','\u{0412}','\u{13F4}','\u{15F7}','\u{A4D0}','\u{10282}','\u{102A1}','\u{10301}','\u{A7B4}','\u{0432}']);

    confusables.insert('C', vec!['\u{1F74C}','\u{118F2}','\u{118E9}','\u{FF23}','\u{216D}','\u{2102}','\u{212D}','\u{1D402}','\u{1D436}','\u{1D46A}','\u{1D49E}','\u{1D4D2}','\u{1D56E}','\u{1D5A2}','\u{1D5D6}','\u{1D60A}','\u{1D63E}','\u{1D672}','\u{03FD}','\u{2CA4}','\u{0421}','\u{13DF}','\u{A4DA}','\u{102A2}','\u{10302}','\u{10415}','\u{1051C}','\u{00C7}','\u{04AA}','\u{0187}']);

    confusables.insert('D', vec!['\u{216E}','\u{2145}','\u{1D403}','\u{1D437}','\u{1D46B}','\u{1D49F}','\u{1D4D3}','\u{1D507}','\u{1D53B}','\u{1D56F}','\u{1D5A3}','\u{1D5D7}','\u{1D60B}','\u{1D63F}','\u{1D673}','\u{13A0}','\u{15DE}','\u{15EA}','\u{A4D3}','\u{0110}','\u{00D0}','\u{0189}']);

    confusables.insert('E', vec!['\u{22FF}','\u{FF25}','\u{2130}','\u{1D404}','\u{1D438}','\u{1D46C}','\u{1D4D4}','\u{1D508}','\u{1D53C}','\u{1D570}','\u{1D5A4}','\u{1D5D8}','\u{1D60C}','\u{1D640}','\u{1D674}','\u{0395}','\u{1D6AC}','\u{1D6E6}','\u{1D720}','\u{1D75A}','\u{1D794}','\u{0415}','\u{2D39}','\u{13AC}','\u{A4F0}','\u{118A6}','\u{118AE}','\u{10286}','\u{011A}','\u{0246}','\u{2107}','\u{0510}','\u{13CB}','\u{10401}','\u{0190}']);

    confusables.insert('F', vec!['\u{2131}','\u{1D405}','\u{1D439}','\u{1D46D}','\u{1D4D5}','\u{1D509}','\u{1D53D}','\u{1D571}','\u{1D5A5}','\u{1D5D9}','\u{1D60D}','\u{1D641}','\u{1D675}','\u{A798}','\u{03DC}','\u{1D7CA}','\u{15B4}','\u{A4DD}','\u{118C2}','\u{118A2}','\u{10287}','\u{102A5}','\u{10525}','\u{0191}']);

    confusables.insert('G', vec!['\u{1D406}','\u{1D43A}','\u{1D46E}','\u{1D4A2}','\u{1D4D6}','\u{1D50A}','\u{1D53E}','\u{1D572}','\u{1D5A6}','\u{1D5DA}','\u{1D60E}','\u{1D642}','\u{1D676}','\u{050C}','\u{13C0}','\u{13F3}','\u{A4D6}','\u{01E6}','\u{011E}','\u{01E4}','\u{0193}','\u{0509}']);

    confusables.insert('H', vec!['\u{FF28}','\u{2108}','\u{210C}','\u{210D}','\u{1D407}','\u{1D43B}','\u{1D46F}','\u{1D4D7}','\u{1D573}','\u{1D5A7}','\u{1D5DB}','\u{1D60F}','\u{1D643}','\u{1D677}','\u{0397}','\u{1D6AE}','\u{1D6E8}','\u{1D722}','\u{1D75C}','\u{1D796}','\u{2C8E}','\u{041D}','\u{13BB}','\u{157C}','\u{A4E7}','\u{102CF}','\u{2C67}','\u{04A2}','\u{0126}','\u{04C9}','\u{04C7}']);

//NOTE: the unicode confusables list appears to entirely omit confusables for the latin capital 'I', despite there being many of them.
//TODO: figure out 'I' confusables. Many of them should be findable at code points one higher than the 'H' confusables.
/*
    confusables.insert('I', vec!['\u{FF29}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);
*/

/*
    confusables.insert('J', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('K', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('L', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('M', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('N', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('O', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('P', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('Q', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('R', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('S', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('T', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('U', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('V', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('W', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('X', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('Y', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('Z', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('a', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('b', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('c', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('d', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('e', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('f', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('g', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('h', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('i', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('j', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('k', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('l', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('m', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('n', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('o', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('p', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('q', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('r', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('s', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('t', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('u', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('v', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('w', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('x', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('y', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);

    confusables.insert('z', vec!['\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}','\u{}',]);
*/

    let mut output = String::new();
    let mut input_chars = input.chars().peekable();
    while input_chars.peek() != None {
        let next = input_chars.next().unwrap();
        //don't process new lines, but allow them in inputs
        if next == '\n' {
            output.push(next);
            continue;
        }
        //TODO: handle the error cases here instead of just blindly unwrapping.
        let next_out = rand::thread_rng().choose(confusables.get(&next).unwrap());
        output.push(*next_out.unwrap());
    }
    return output;
}
